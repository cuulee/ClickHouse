version: '2'
services:
    zoo1:
        image: zookeeper
        restart: always
        environment:
            ZOO_MY_ID: 1
            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888
        
    zoo2:
        image: zookeeper
        restart: always
        environment:
            ZOO_MY_ID: 2
            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888

    zoo3:
        image: zookeeper
        restart: always
        environment:
            ZOO_MY_ID: 3
            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888


    clickhouse1:
        image: ubuntu:14.04
        volumes:
            - ../../../build/:/clickhouse/:ro
            - ./instance1/:/instance/
        command:
            - /clickhouse/dbms/src/Server/clickhouse
            - --config-file=/instance/config.xml
            - --log-file=/instance/clickhouse-server.log
        depends_on: ["zoo1", "zoo2", "zoo3"]
        
    clickhouse2:
        image: ubuntu:14.04
        volumes:
            - ../../../build/:/clickhouse/:ro
            - ./instance2/:/instance/
        command:
            - /clickhouse/dbms/src/Server/clickhouse
            - --config-file=/instance/config.xml
            - --log-file=/instance/clickhouse-server.log
        depends_on: ["zoo1", "zoo2", "zoo3"]
        
